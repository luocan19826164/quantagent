# 量化规则收集 Agent - 使用指南

## 🎉 系统已成功部署！

### 访问地址
**浏览器访问**: http://localhost:8080

---

## 📝 快速开始

### 1. 启动应用

```bash
cd /Users/mac/Documents/project/cursor/quantagent
python backend/app.py
```

或者使用启动脚本：
```bash
./start.sh
```

### 2. 配置 LLM Provider

在 `.env` 文件中配置你的 LLM Provider（三选一，按优先级自动选择）：

```env
# 方式1: OpenRouter（推荐中国用户访问 Claude）
OPENROUTER_API_KEY=sk-or-v1-xxxxx
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
OPENROUTER_MODEL=anthropic/claude-sonnet-4

# 方式2: DeepSeek
DEEPSEEK_API_KEY=sk-xxxxx
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
DEEPSEEK_MODEL=deepseek-reasoner

# 方式3: OpenAI
OPENAI_API_KEY=sk-proj-xxxxx
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o
```

详细配置说明见 `.env配置说明.md`

### 3. 在浏览器中使用

1. 打开 http://localhost:8080
2. 在对话框中描述你的量化策略想法
3. Agent会引导你逐步完善细节
4. 完成后点击"生成最终规则"按钮

---

## 💡 使用示例

### 示例对话流程

**用户**: 我想做一个趋势跟踪策略，当价格突破30日均线时买入

**Agent**: 这是一个经典的趋势跟踪策略！我来帮你完善细节...

**用户**: 交易BTC和ETH

**Agent**: 好的，交易对已确认。请问你想使用什么时间周期的K线？

**用户**: 1小时K线

**Agent**: 明白了。那么关于风控，你的止盈止损计划是什么？

**用户**: 止盈5%，止损2%

**Agent**: 很好！最后一个问题，单次最大投入多少比例的资金？

**用户**: 最多30%

**Agent**: 完美！你的策略信息已经完整了...

---

## 🛠️ 功能特性

### 1. 智能对话引导
- 自动识别用户策略意图
- 循序渐进收集必要信息
- 检查已有工具和指标能否实现

### 2. 信息收集
Agent会收集以下信息：
- ✅ 市场类型（现货/合约）
- ✅ 交易对列表
- ✅ K线时间周期
- ✅ 建仓规则
- ✅ 止盈规则
- ✅ 止损规则
- ✅ 最大仓位比例

### 3. 实时状态追踪
右侧面板会实时显示：
- 已收集的信息
- 缺失的字段
- 使用的技术指标
- 完整性状态

### 4. 最终规则生成
信息完整后可生成JSON格式的策略配置，包含：
- 用户需求详情
- 执行逻辑分析
- 调用的工具和指标

---

## 🔧 技术指标说明

系统已内置以下技术指标：

| 指标 | 名称 | 用途 |
|------|------|------|
| MA | 移动平均线 | 趋势判断 |
| EMA | 指数移动平均线 | 趋势判断（更敏感） |
| RSI | 相对强弱指标 | 超买超卖判断 |
| MACD | 指数平滑异同 | 趋势和动量 |
| BOLL | 布林带 | 价格波动区间 |
| KDJ | 随机指标 | 超买超卖和交叉信号 |
| ATR | 平均真实波幅 | 波动性和止损位 |
| VOLUME | 成交量 | 交易活跃度 |
| OBV | 能量潮 | 资金流向 |
| SAR | 抛物线转向 | 追踪趋势 |

点击界面底部的"可用技术指标"可查看详细说明。

---

## 📊 支持的交易配置

### 市场类型
- 现货
- 合约
- 期货
- 期权

### 交易对（示例）
BTC, ETH, BNB, ADA, DOGE, SOL, XRP, DOT, MATIC, LINK, AVAX, ATOM, UNI, LTC, ETC

### K线周期
- 1分钟 (1m)
- 5分钟 (5m)
- 15分钟 (15m)
- 30分钟 (30m)
- 1小时 (1h)
- 4小时 (4h)
- 日线 (1d)
- 周线 (1w)
- 月线 (1M)

---

## 🔍 API接口说明

### 初始化会话
```
POST /api/init
响应: { "session_id": "...", "greeting": "..." }
```

### 发送消息
```
POST /api/chat
请求: { "session_id": "...", "message": "..." }
响应: { "success": true, "response": "...", "state": {...} }
```

### 获取状态
```
GET /api/state/{session_id}
响应: { "success": true, "state": {...}, "is_complete": true }
```

### 生成最终规则
```
POST /api/finalize/{session_id}
响应: { "success": true, "rules": {...} }
```

### 重置会话
```
POST /api/reset/{session_id}
响应: { "success": true }
```

---

## 📁 项目结构

```
quantagent/
├── backend/
│   ├── agent/
│   │   ├── quant_agent.py      # Agent核心逻辑
│   │   ├── tools.py             # 工具定义
│   │   ├── indicators.py        # 技术指标
│   │   └── state_manager.py    # 状态管理
│   └── app.py                   # Flask后端
├── frontend/
│   ├── templates/
│   │   └── index.html           # 前端页面
│   └── static/
│       ├── style.css            # 样式
│       └── script.js            # 前端逻辑
├── requirements.txt             # 依赖
├── .env                         # 环境配置
└── README.md                    # 项目说明
```

---

## 🐛 故障排除

### 问题1: 端口被占用
```bash
# 查看占用端口的进程
lsof -i :8080

# 杀死进程
kill -9 <PID>

# 或修改app.py中的端口号
```

### 问题2: 依赖安装失败
```bash
# 升级pip
pip install --upgrade pip

# 重新安装
pip install -r requirements.txt
```

### 问题3: API Key错误
确保 `.env` 文件中的 API Key 正确，并且有足够的额度。

---

## 📞 技术支持

如有问题，请检查：
1. Python版本 >= 3.8
2. 依赖是否正确安装
3. .env配置是否正确
4. 端口是否被占用
5. API Key是否有效

---

## 🚀 下一步

当前系统只负责**收集和验证量化规则**，生成的JSON配置可用于：

1. **执行Agent开发**（待实现）
   - 实际的建仓逻辑
   - 实时监控和执行
   - 止盈止损管理

2. **回测系统对接**
   - 导入历史数据
   - 验证策略效果
   - 优化参数

3. **交易所API对接**
   - 实盘交易执行
   - 账户管理
   - 风险控制

---

祝你的量化交易策略大获成功！ 🎉

