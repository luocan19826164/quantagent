# 模型动态切换功能说明

现在支持在运行时动态切换模型，切换时**保持上下文和历史记录**不变。

## 功能特性

✅ **无缝切换**：切换模型时，对话历史和状态保持一致  
✅ **多模型支持**：OpenAI、DeepSeek等  
✅ **无需重启**：可在应用运行时动态切换  

## 配置环境变量

在 `.env` 文件中配置多个模型的API密钥：

```bash
# OpenAI
OPENAI_API_KEY=sk-your-openai-key

# DeepSeek
DEEPSEEK_API_KEY=sk-your-deepseek-key
```

## API接口

### 1. 获取可用模型列表

```bash
GET /api/models
```

响应：
```json
{
  "success": true,
  "models": [
    {
      "provider": "openai",
      "models": ["gpt-4o", "gpt-4o-mini", "gpt-4-turbo"],
      "base_url": "https://api.openai.com/v1"
    },
    {
      "provider": "deepseek",
      "models": ["deepseek-chat", "deepseek-coder"],
      "base_url": "https://api.deepseek.com/v1"
    }
  ]
}
```

### 2. 切换模型

```bash
POST /api/switch-model/<session_id>
Content-Type: application/json

{
  "provider": "deepseek",
  "model": "deepseek-chat"
}
```

响应：
```json
{
  "success": true,
  "message": "已切换模型到 deepseek-chat",
  "current_model": {
    "model": "deepseek-chat",
    "api_key_set": true,
    "base_url": "https://api.deepseek.com/v1"
  }
}
```

### 3. 获取当前模型信息

```bash
GET /api/model-info/<session_id>
```

## 前端实现示例

```javascript
// 获取可用模型
async function loadModels() {
    const response = await fetch('/api/models');
    const data = await response.json();
    return data.models;
}

// 切换模型
async function switchModel(provider, model) {
    const response = await fetch(`/api/switch-model/${sessionId}`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ provider, model })
    });
    return await response.json();
}

// 使用
switchModel('deepseek', 'deepseek-chat').then(result => {
    console.log(result.message);
});
```

## 工作原理

1. Agent实例保持 `state` 和 `memory` 不变
2. 只切换 `llm` 实例
3. 下一次对话使用新模型继续上下文

## 注意事项

- 确保环境变量中配置了对应模型的API密钥
- 切换后立即生效，无需重启应用
- 对话历史和上下文完全保持不变
